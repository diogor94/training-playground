pipeline {
    agent none 
	 stages {
		stage ("Stage 1") {
			agent { 
				dockerfile {
					filename '02 - Dockerfile - Dockerfile Agent'
					dir '003 - Defining Execution Environments'
					additionalBuildArgs '--build-arg ENV_VARIABLE="Value for build"'
					args '-e ENV_VARIABLE="Value for execution"'
				}
			} 
			steps {
                sh 'if [ "$ENV_VARIABLE" != "Value for execution" ]; then exit 1; fi'
            }
		}
		stage ("Stage 2") {
			agent { 
				dockerfile {
					filename '03 - Dockerfile - Install Software Dockerfile'
					dir '003 - Defining Execution Environments'
				}
			}
			steps {
				echo "Don't install curl here!"
				sh "curl www.google.com"
			}
		}
	}
}
